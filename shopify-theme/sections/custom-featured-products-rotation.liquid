{% comment %}
  ============================================
  Featured Products Rotation
  Pulls products from multiple collections, shuffles on page load
  Paste into: sections/custom-featured-products-rotation.liquid
  ============================================
{% endcomment %}

<section class="featured-rotation section-{{ section.id }}-padding">
  <div class="page-width">
    <h2 class="featured-rotation__heading">{{ section.settings.heading | default: 'Featured Products' }}</h2>

    <div class="featured-rotation__grid" id="featuredGrid-{{ section.id }}">
      {% for block in section.blocks %}
        {% assign col = collections[block.settings.collection] %}
        {% if col %}
          {% for product in col.products limit: block.settings.count %}
            <div class="featured-rotation__card" {{ block.shopify_attributes }}>
              <a href="{{ product.url }}">
                <div class="featured-rotation__image">
                  {% if product.featured_image %}
                    {{ product.featured_image | image_url: width: 400 | image_tag: loading: 'lazy', alt: product.title }}
                  {% endif %}
                </div>
                <h3 class="featured-rotation__product-title">{{ product.title }}</h3>
                <p class="featured-rotation__price">{{ product.price | money }}</p>
              </a>
            </div>
          {% endfor %}
        {% endif %}
      {% endfor %}
    </div>
  </div>
</section>

<script>
/* Shuffle product cards on page load for variety */
document.addEventListener('DOMContentLoaded', function() {
  var grid = document.getElementById('featuredGrid-{{ section.id }}');
  if (!grid) return;
  var cards = Array.from(grid.children);
  for (var i = cards.length - 1; i > 0; i--) {
    var j = Math.floor(Math.random() * (i + 1));
    grid.appendChild(cards[j]);
  }
  /* Only show the configured number of products */
  var maxShow = {{ section.settings.display_count | default: 4 }};
  cards = Array.from(grid.children);
  cards.forEach(function(card, index) {
    card.style.display = index < maxShow ? '' : 'none';
  });
});
</script>

<style>
  .featured-rotation { padding: 48px 0; }
  .featured-rotation__heading {
    text-align: center;
    font-family: var(--font-heading-family, 'Trirong', serif);
    font-size: 2rem;
    font-weight: 300;
    margin-bottom: 32px;
  }
  .featured-rotation__grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 24px;
  }
  .featured-rotation__card a {
    text-decoration: none;
    color: inherit;
  }
  .featured-rotation__image {
    aspect-ratio: 1;
    overflow: hidden;
    margin-bottom: 12px;
    background: var(--color-background, #efecec);
    border-radius: 4px;
  }
  .featured-rotation__image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s;
  }
  .featured-rotation__card:hover img { transform: scale(1.05); }
  .featured-rotation__product-title {
    font-size: 0.9rem;
    font-weight: 600;
    margin-bottom: 4px;
    line-height: 1.3;
  }
  .featured-rotation__price {
    font-size: 0.85rem;
    opacity: 0.6;
  }

  @media (max-width: 749px) {
    .featured-rotation__grid { grid-template-columns: repeat(2, 1fr); gap: 16px; }
  }
</style>

{% schema %}
{
  "name": "Featured Rotation",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Featured Products"
    },
    {
      "type": "range",
      "id": "display_count",
      "label": "Products to Show",
      "min": 4,
      "max": 12,
      "step": 2,
      "default": 4
    }
  ],
  "blocks": [
    {
      "type": "source_collection",
      "name": "Source Collection",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        },
        {
          "type": "range",
          "id": "count",
          "label": "Products from this collection",
          "min": 1,
          "max": 8,
          "step": 1,
          "default": 4
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Featured Rotation"
    }
  ]
}
{% endschema %}
