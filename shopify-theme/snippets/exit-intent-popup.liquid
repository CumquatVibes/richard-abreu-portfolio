{% comment %}
  ============================================
  Exit-Intent Popup with First-Time Discount
  Paste into: snippets/exit-intent-popup.liquid

  Then add to layout/theme.liquid before </body>:
  {% render 'exit-intent-popup' %}

  IMPORTANT: Create a discount code "WELCOME10" in Shopify Admin > Discounts
  ============================================
{% endcomment %}

{% unless customer %}
<div id="cvExitPopup" style="display:none; position:fixed; inset:0; z-index:9999; background:rgba(0,0,0,0.6); animation: cvFadeIn 0.3s ease;">
  <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(26,29,28,0.85); backdrop-filter:blur(24px) saturate(1.4); -webkit-backdrop-filter:blur(24px) saturate(1.4); border:1px solid rgba(255,255,255,0.06); color:#efecec; max-width:400px; width:90%; padding:36px 32px; text-align:center; border-radius:16px; animation: cvSlideUp 0.4s ease; overflow:hidden;">
    <button onclick="document.getElementById('cvExitPopup').style.display='none'"
            style="position:absolute; top:12px; right:16px; background:none; border:none; font-size:1.5rem; cursor:pointer; color:#999; line-height:1;">&times;</button>

    <p style="font-size:0.7rem; text-transform:uppercase; letter-spacing:0.15em; color:#e8941f; font-weight:700; margin-bottom:12px;">Wait â€” Don't Leave Yet!</p>
    <h2 style="font-family:var(--font-heading-family, 'Trirong', serif); font-size:1.5rem; font-weight:300; margin-bottom:8px; color:#efecec;">Here's 10% Off Your First Order</h2>
    <p style="font-size:0.9rem; opacity:0.6; margin-bottom:24px; color:#efecec;">Use this code at checkout:</p>

    <div style="background:rgba(232,148,31,0.08); backdrop-filter:blur(10px); -webkit-backdrop-filter:blur(10px); padding:14px; font-size:1.4rem; font-weight:700; letter-spacing:0.12em; margin-bottom:24px; border:1px solid rgba(232,148,31,0.25); border-radius:12px; color:#f4b88a;">
      WELCOME10
    </div>

    <a href="/collections/all"
       style="display:inline-block; background:#e8941f; color:#fff; padding:14px 32px; text-decoration:none; font-weight:600; text-transform:uppercase; font-size:0.8rem; letter-spacing:0.05em; border-radius:8px; transition:all 0.3s;"
       onmouseover="this.style.boxShadow='0 0 30px rgba(232,148,31,0.35), 0 0 60px rgba(232,148,31,0.12)'" onmouseout="this.style.boxShadow='none'"
      Shop Now
    </a>

    <p style="font-size:0.7rem; opacity:0.4; margin-top:16px;">100% Human-Made Art &middot; Veteran-Owned</p>
  </div>
</div>

<style>
  @keyframes cvFadeIn { from { opacity:0; } to { opacity:1; } }
  @keyframes cvSlideUp { from { opacity:0; transform:translate(-50%,-55%); } to { opacity:1; transform:translate(-50%,-50%); } }
</style>

<script>
(function() {
  if (localStorage.getItem('cv_exit_shown')) return;

  function showPopup() {
    var popup = document.getElementById('cvExitPopup');
    if (popup) {
      popup.style.display = 'block';
      localStorage.setItem('cv_exit_shown', 'true');
    }
  }

  /* Desktop: mouse leaves viewport */
  document.addEventListener('mouseout', function handler(e) {
    if (e.clientY <= 0 && !localStorage.getItem('cv_exit_shown')) {
      showPopup();
      document.removeEventListener('mouseout', handler);
    }
  });

  /* Mobile: show after 30s of browsing */
  if ('ontouchstart' in window) {
    setTimeout(function() {
      if (!localStorage.getItem('cv_exit_shown')) {
        showPopup();
      }
    }, 30000);
  }

  /* Close on backdrop click */
  var popup = document.getElementById('cvExitPopup');
  if (popup) {
    popup.addEventListener('click', function(e) {
      if (e.target === this) this.style.display = 'none';
    });
  }
})();
</script>
{% endunless %}
